[TOC]
# æ¨¡å—åŒ–çš„æ‚ä¸ƒæ‚å…«

æœ¬æ–‡é¦–å…ˆä¼šå…ˆæŒ‰ç…§æ—¶é—´é¡ºåºåˆæ­¥ä»‹ç»```CommonJS```ã€```AMD```ã€```CMD```ã€```UMD```ã€```ES6 Module```ï¼Œç„¶åé’ˆå¯¹```CommonJS```å’Œ```ES6 Module```è¿›è¡Œæ·±å…¥é˜è¿°

## ä¸€ã€åˆæ­¥ä»‹ç»

åœ¨å¹³å¸¸å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„è¿™äº›ä»£ç éƒ½æ˜¯è¢«ä¸€ä¸ªä¸ªçš„æ¨¡å—æ„æˆçš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨npmä¸Šä¸‹è½½æˆ‘ä»¬éœ€è¦çš„åŒ…ï¼Œç„¶åç»„è£…åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œå°±å¥½åƒç»„è£…æ¨¡å—ä¸€æ ·ï¼Œéšç€mvvmæ¡†æ¶çš„æ™®åŠï¼Œä¸»æµçš„å¼€å‘æ–¹å¼éƒ½å˜æˆäº†æ¨¡å—åŒ–ã€‚åœ¨ä¹‹å‰ï¼Œjsæ¨¡å—åŒ–è¿˜æ˜¯é€šè¿‡å‘½åç©ºé—´æ¥å®ç°çš„ï¼Œå†åæ¥äº§ç”Ÿäº†ä¸€ä¸ªæ¨¡å—åŒ–è§„èŒƒï¼ˆ```CommonJs```ï¼‰ï¼Œ```CommonJs```æ˜¯è¯ç”Ÿäºnodeç¤¾åŒºï¼Œä½†å®ƒåªèƒ½åœ¨æœåŠ¡ç«¯è¿è¡Œï¼Œåœ¨æµè§ˆå™¨ç«¯è¿˜æ˜¯ç”¨ä¸äº†ï¼Œäºæ˜¯ï¼Œç¤¾åŒºä¾¿å‡ºäº†```AMD```è§„èŒƒï¼Œå›½å†…åˆå‡ºäº†```CMD```ï¼Œåæ¥åˆå‡ºäº†```UMD```ï¼Œå…¶å®è¿™ä¸‰ä¸ªè§„èŒƒéƒ½æ˜¯ä¸ºäº†å¸®åŠ©æ¨¡å—åŒ–å¼€å‘ã€‚ç›®å‰æ¯”è¾ƒæµè¡Œçš„æ˜¯```ES6 Module```è§„èŒƒã€‚

### CommonJS

```CommonJS```è§„èŒƒçš„ç‰¹ç‚¹ï¼š

- **ä¸€ä¸ªæ–‡ä»¶å³ä¸€ä¸ªæ¨¡å—**ã€‚æ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡ã€å‡½æ•°ã€ç±»éƒ½æ˜¯ç§æœ‰çš„ï¼Œå¤–ç•Œæ— æ³•è®¿é—®æ¨¡å—å†…çš„å†…å®¹

- **é€šè¿‡```module.exports```æš´éœ²æ¨¡å—å†…çš„å¸¸é‡ã€å‡½æ•°ã€æ–‡ä»¶ã€æ¨¡å—ç­‰**

- **```module.exports```å¯¼å‡ºæ¨¡å—ï¼Œè¾“å‡ºçš„æ˜¯å€¼çš„æ‹·è´;æ¨¡å—å¯¼å…¥çš„ä¹Ÿæ˜¯è¾“å‡ºå€¼çš„æ‹·è´**

  - ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦è¾“å‡ºè¿™ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼åœ¨æ¨¡å—å†…éƒ¨çš„å˜åŒ–æ˜¯ç›‘å¬ä¸åˆ°çš„ï¼ˆå¯å¯¹æ¯”ES6ï¼‰

- **ä½¿ç”¨```require```å¼•å…¥æ¨¡å—**

- **åŒæ­¥åŠ è½½**ï¼š
  - æ¨¡å—æ˜¯åŒæ­¥åŠ è½½çš„ï¼Œå³åªæœ‰åŠ è½½å®Œæˆï¼Œæ‰èƒ½æ‰§è¡Œåé¢çš„æ“ä½œï¼›
  - å› ä¸º```CommonJS```æ˜¯è¿è¡Œåœ¨```Nodejs```æœåŠ¡ç«¯çš„ï¼Œ```Node.js```æ˜¯åŒæ­¥æ¨¡å—åŠ è½½ï¼Œå› æ­¤```CommonJS```æ˜¯ç”¨åŒæ­¥çš„æ–¹å¼åŠ è½½æ¨¡å—ï¼Œå¯¹æœåŠ¡ç«¯æ¥è¯´```require()```æ˜¯æœ¬åœ°åŠ è½½ï¼Œæ­£å› ä¸ºæ‰€æœ‰æ–‡ä»¶éƒ½åœ¨æœ¬åœ°ï¼Œè¯»å–é€Ÿåº¦å¾ˆå¿«ï¼ŒåŒæ­¥åŠ è½½ä¸ä¼šé€ æˆä»€ä¹ˆä¸å¥½çš„å½±å“ï¼Œä½†æ˜¯åœ¨æµè§ˆå™¨ç«¯ï¼Œå› ä¸ºç½‘ç»œçš„åŸå› ï¼ŒåŒæ­¥åŠ è½½å°±ä¼šåœ¨ä¸€å®šç¨‹åº¦é™åˆ¶èµ„æºçš„åŠ è½½é€Ÿåº¦

- **æ¨¡å—æ˜¯è¿è¡Œæ—¶åŠ è½½(è¿è¡Œæ—¶åŠ è½½)**

  - ```CommonJS```è§„èŒƒä¸­ï¼Œ```require()```æ˜¯ç”¨æ¥åŠ è½½ä¸€ä¸ªæ¨¡å—ï¼Œé‚£```require```è¿™è¯­å¥åšäº†ä»€ä¹ˆäº‹ï¼Ÿ

    è¿è¡Œæ–‡ä»¶æ—¶ï¼Œ```Node```å‘ç°æ–‡ä»¶ä¸­ä½¿ç”¨```require```åŠ è½½ä¸€ä¸ªAæ¨¡å—ï¼Œ```Node```é¦–å…ˆä¼šæ‰§è¡Œæ•´ä¸ªAæ¨¡å—ï¼Œç„¶ååœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°±æ˜¯Aæ¨¡å—çš„ä¸€ä¸ªè¡¨è¾¾è½½ä½“ï¼Œæ¥ç€ä»è¯¥å¯¹è±¡çš„```exports```å±æ€§ä¸­å–å‡ºAæ¨¡å—è¾“å‡ºçš„å„ä¸ªæ¥å£ï¼Œä¾›å½“å‰æ–‡ä»¶ä½¿ç”¨
    
    ```js
    {
       id: '',  // å”¯ä¸€çš„æ¨¡å—å
       exports: {  // åŒ…å«æ¨¡å—è¾“å‡ºçš„å„ä¸ªæ¥å£
          ...
       },
       loaded: true,  // æ¨¡å—çš„è„šæœ¬æ˜¯å¦æ‰§è¡Œå®Œæ¯•
       ...
    }
    ```
    
    è‹¥åœ¨æ–‡ä»¶ä¸­å†æ¬¡ä½¿ç”¨```require```åŠ è½½Aæ¨¡å—ï¼Œ```Node```ä¹Ÿä¸ä¼šé‡å¤æ‰§è¡ŒAæ¨¡å—ï¼Œè€Œæ˜¯ç›´æ¥åœ¨å†…å­˜ä¸­æ‰¾åˆ°Aæ¨¡å—çš„è¡¨è¾¾å¯¹è±¡ï¼Œå–å‡º```exports```å±æ€§çš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´æ— è®ºé€šè¿‡```require```åŠ è½½å¤šå°‘æ¬¡ç›¸åŒçš„æ¨¡å—ï¼Œéƒ½åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŠ è½½ä¸­è¿è¡Œï¼Œå¾€åéƒ½æ˜¯ä»å¯¹è±¡ä¸­å–å‡º```exports```å±æ€§çš„å€¼ï¼ˆé™¤éæ‰‹åŠ¨æ¸…é™¤ç³»ç»Ÿç¼“å­˜ï¼‰

ç„¶åå¯ä»¥çœ‹ä¸€ä¸‹```CommonJS```è§„èŒƒçš„ä»£ç 

```js
var foo = require('./foo') // å¼•å…¥æ¨¡å—
var foo = require('event').some // å¼•å…¥æ¨¡å—çš„æŸä¸ªå±æ€§

function fn() {
  console.log('fn')
}
module.exports.fn = fn // é€šè¿‡module.exportså°†fnå‡½æ•°æš´éœ²å‡ºå»
// exports.fn = fn // æˆ–è€…é€šè¿‡exportsæš´éœ²å‡ºå»
```

### AMDï¼ˆAsync Module Definition ï¼‰

```AMD```æ˜¯å¼‚æ­¥æ¨¡å—åŠ è½½æœºåˆ¶ï¼Œä½œè€…ä»¥```RequireJS```å®ç°äº†```AMD```è§„èŒƒï¼Œæ‰€ä»¥è¯´èµ·```AMD```è§„èŒƒå°±èƒ½æƒ³åˆ°```RequireJS```,å®ƒçš„ç‰¹ç‚¹ï¼š

- **ä½¿ç”¨defineå®šä¹‰æ¨¡å—**: ```define```å¯ä»¥ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯æ¨¡å—å(```string```)ã€ä¾èµ–æ¨¡å—ï¼ˆ```array```ï¼‰ã€å›è°ƒå‡½æ•°ï¼ˆ```function```ï¼‰

  - ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¨¡å—åï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œå¯é€‰å‚æ•°ã€‚è‹¥ä¸å­˜åœ¨åˆ™æ¨¡å—æ ‡è¯†åº”è¯¥é»˜è®¤å®šä¹‰ä¸ºåœ¨åŠ è½½å™¨ä¸­è¢«è¯·æ±‚è„šæœ¬çš„æ ‡è¯†ã€‚å¦‚æœå­˜åœ¨ï¼Œé‚£ä¹ˆæ¨¡å—æ ‡è¯†å¿…é¡»ä¸ºé¡¶å±‚çš„æˆ–è€…ä¸€ä¸ªç»å¯¹çš„æ ‡è¯†

  - ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¾èµ–æ¨¡å—ï¼Œæ•°ç»„ç±»å‹ï¼Œæ˜¯ä¸€ä¸ªå½“å‰æ¨¡å—ä¾èµ–çš„ï¼Œå·²è¢«æ¨¡å—å®šä¹‰çš„æ¨¡å—æ ‡è¯†çš„æ•°ç»„å­—é¢é‡

  - ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªéœ€è¦è¿›è¡Œå®ä¾‹åŒ–çš„å‡½æ•°æˆ–è€…ä¸€ä¸ªå¯¹è±¡

    ```js
    // å®šä¹‰æ— ä¾èµ–çš„æ¨¡å—
    define({
      fn1: function(a){
        return a
      },
      arr1: []
    })
    
    // å®šä¹‰æœ‰ä¾èµ–çš„æ¨¡å—
    define(["a"], function(a){
      return {
        fn1: function(){
          return a.num
        }
      }
    })
    
    // å…·åæ¨¡å—
    define("foo", [ "a", "b"], function(a, b){
        ...
    });
    ```

- **ä½¿ç”¨```require```å¼•å…¥æ¨¡å—**:

- **å¼‚æ­¥åŠ è½½æ¨¡å—**ï¼šæ¨¡å—çš„åŠ è½½ä¸å½±å“å®ƒåé¢è¯­å¥çš„è¿è¡Œï¼Œæ‰€æœ‰ä¾èµ–è¿™ä¸ªæ¨¡å—çš„è¯­å¥ï¼Œéƒ½å®šä¹‰åœ¨ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­ï¼Œç­‰åˆ°åŠ è½½å®Œæˆä¹‹åï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°æ‰ä¼šè¿è¡Œ

- **ä¾èµ–å‰ç½®ï¼Œæå‰æ‰§è¡Œ**ï¼š
  - åœ¨```define```æ–¹æ³•é‡Œä¼ å…¥çš„ä¾èµ–æ¨¡å—(æ•°ç»„)ï¼Œä¼šåœ¨ä¸€å¼€å§‹å°±ä¸‹è½½å¹¶æ‰§è¡Œ
  - ```RequireJS```ä»2.0å¼€å§‹ï¼Œä¹Ÿæ”¹æˆå¯ä»¥å»¶è¿Ÿæ‰§è¡Œï¼Œåªæ˜¯å†™æ³•ä¸Šå’Œæå‰æ‰§è¡Œæœ‰äº›ä¸åŒã€‚è™½ç„¶ ```AMD```ä¹Ÿæ”¯æŒ```CMD```å†™æ³•ï¼Œä½†ä¾èµ–å‰ç½®æ˜¯å®˜æ–¹æ–‡æ¡£çš„é»˜è®¤æ¨¡å—å®šä¹‰å†™æ³•

ç„¶åå¯ä»¥çœ‹ä¸€ä¸‹```AMD```è§„èŒƒçš„ä»£ç 

```js
// src/foo.js
// ä¼šåœ¨å£°æ˜å¹¶åˆå§‹åŒ–è¦ç”¨åˆ°çš„æ‰€æœ‰æ¨¡å—(aå’Œb)ï¼Œä¸ç®¡åç»­æ˜¯å¦ç”¨åˆ°
// å‚æ•°1 "foo" æ˜¯æ¨¡å—å
// å‚æ•°2 ["a", "b"] æ˜¯ä¾èµ–çš„æ¨¡å—å
// å‚æ•°3 function(){} æ˜¯å›è°ƒå‡½æ•°
define("foo", ["a", "b"], function (a, b) { // å®šä¹‰foo.jsæ¨¡å—
    const NUM = 2
    const fn = function () {
      console.log('foo')
    }
    return {
        NUM: NUM,
        fn: fn
    }
})


// app.js
require.config({ // é€šè¿‡require.config()è®¾ç½®æ¯ä¸ªæ¨¡å—è·¯å¾„å’Œå¼•ç”¨å
  baseUrl: "src",
  paths: {
    "foo": "foo", // å®é™…è·¯å¾„ä¸ºsrc/foo.js, æŒ‡å®šfoo.jsçš„å¼•ç”¨åä¸ºfoo
  }
})

// åŠ è½½foo.jsæ¨¡å—
// åŠ è½½æ¨¡å—æ—¶è¦å°†æ¨¡å—åï¼ˆä¹Ÿå¯ä»¥æ˜¯æ–‡ä»¶è·¯å¾„ï¼‰æ”¾åœ¨[]ä¸­ä½œä¸ºreqiure()çš„ç¬¬ä¸€å‚æ•°ï¼Œ
require(["foo"],function(foo){
  console.log(foo)
})
```

### CMD

```CMD```æ˜¯é€šç”¨æ¨¡å—å®šä¹‰ï¼Œ```CMD```æ˜¯```SeaJS```åœ¨æ¨å¹¿è¿‡ç¨‹ä¸­ç”Ÿäº§çš„å¯¹æ¨¡å—å®šä¹‰çš„è§„èŒƒï¼Œ```SeaJS```çš„ä½œè€…å°±æ˜¯å¤§åé¼é¼çš„ç‰ä¼¯ï¼Œå®ƒçš„ç‰¹ç‚¹ï¼š

- **ä¸€ä¸ªæ–‡ä»¶ä¸ºä¸€ä¸ªæ¨¡å—**
- **ä½¿ç”¨defineå®šä¹‰æ¨¡å—**
- **ä½¿ç”¨requireå¼•å…¥æ¨¡å—**
- **ä¾èµ–å°±è¿‘ï¼Œå»¶è¿Ÿæ‰§è¡Œ**ï¼š åªæœ‰æ‰§è¡Œåˆ°```require()```æ—¶ï¼Œä¾èµ–æ¨¡å—æ‰æ‰§è¡Œã€‚

```AMD```å’Œ```CMD```å…¶å®å¾ˆå¤šåœ°æ–¹ç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒä»¬æœ€å¤§åŒºåˆ«æ˜¯æ‰§è¡Œæ–¹å¼çš„ä¸åŒï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç»è¿‡```AMD```ç¼–è¯‘åï¼Œæ‰€æœ‰```require```å¼•å…¥çš„æ¨¡å—éƒ½è¢«å‰ç½®äº†ï¼Œ```CMD```è™½ç„¶ä¹Ÿä¼šå°†```require```çš„ä»£ç ä¸‹è½½ä¸‹æ¥ï¼Œä½†æ˜¯å®ƒä¸ä¼šå»æ‰§è¡Œï¼Œç›´åˆ°ä»£ç è¿è¡Œåˆ°é‚£ä¸ªæ¨¡å—çš„ä¾èµ–æ‰ä¼šå»æ‰§è¡Œå¯¹åº”æ¨¡å—

```js
/** AMDå†™æ³• **/
define(['./a','./b'], function (a, b) {
    //ä¾èµ–ä¸€å¼€å§‹å°±å†™å¥½ï¼Œç­‰äºåœ¨æœ€å‰é¢å£°æ˜å¹¶åˆå§‹åŒ–äº†è¦ç”¨åˆ°çš„æ‰€æœ‰æ¨¡å—
    a.test() // å³ä¾¿æ²¡ç”¨åˆ°æŸä¸ªæ¨¡å— bï¼Œä½† b è¿˜æ˜¯æå‰æ‰§è¡Œäº†
})
 
/** CMDå†™æ³• **/
define(function (requie, exports, module) {
    if (false) {
        var b = require('./b') //ä¾èµ–å¯ä»¥åœ¨éœ€è¦æ—¶ç”³æ˜
        b.doSomething()
    }
    exports.fn = function() {
      console.log('fn')
    };
})
```

ğŸ‘‡æ˜¯```sea.js```çš„ä½¿ç”¨demo

```js
//a.js
define(function (require, export, module)) {
  // é€šè¿‡requireå¼•å…¥ä¾èµ–
  var foo = require('./foo')
  const NUM = 2
  // é€šè¿‡exportæˆ–è€…é€šè¿‡module.exportsæš´éœ²æ¥å£
  exports.num = NUM
  // module.exports.num = NUM
}


//b.js
// åŠ è½½æ¨¡å—
// æ•°ç»„ä¸­å£°æ˜éœ€è¦åŠ è½½çš„æ¨¡å—ï¼Œå¯ä»¥æ˜¯æ¨¡å—åã€jsæ–‡ä»¶è·¯å¾„
seajs.use(['./a'], function(a) {
  a.fn();
});
```

### UMD

åœ¨```webpack```æ‰“åŒ…è¿‡ç¨‹ä¸­å°±æœ‰```UMD```è¿™ä¸ªé€‰é¡¹ï¼Œ```UMD```å…¶å®æ˜¯ä¸€ä¸ªé€šç”¨è§£å†³æ–¹æ¡ˆï¼Œå®ƒæœ¬èº«ä¸æ˜¯ä»€ä¹ˆæ–°çš„è§„èŒƒï¼Œå°±å¥½ä¼¼ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ä¸€æ ·ã€‚åœ¨æ¨¡å—å®šä¹‰ä¸­ï¼Œå®ƒä¸»è¦åšäº†ä¸‰ä»¶äº‹

- **å…ˆåˆ¤æ–­æ˜¯å¦æ”¯æŒ```AMD```**ã€‚å¦‚æœæ˜¯åˆ™ä½¿ç”¨```AMD```ï¼Œå¦åˆ™æ‰§è¡Œä¸‹ä¸€æ­¥
- **ç„¶ååˆ¤æ–­æ˜¯å¦æ”¯æŒ```CommonJs```**ã€‚å¦‚æœæ˜¯åˆ™ä½¿ç”¨```CommonJs```ï¼Œå¦åˆ™æ‰§è¡Œä¸‹ä¸€æ­¥
- **å¦‚æœéƒ½ä¸æ˜¯ï¼Œåˆ™å®šä¹‰ä¸ºå…¨å±€å˜é‡**

```js
(function (root, fac) {
  if (typeof define === 'function' && define.amd) { // å¦‚æœdefineè¿™ä¸ªæ–¹æ³•è¢«å®šä¹‰ï¼Œä¸”define.amdæ˜¯å¦å­˜åœ¨ï¼Œè¯´æ˜æ˜¯AMD
    define([], fac) // ä»¥AMDçš„è§„èŒƒå»å®šä¹‰æ¨¡å—
  } else if (typeof exports === 'object'){ // exportsä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå°±æ˜¯åˆ¤æ–­æ˜¯å¦åœ¨nodeç¯å¢ƒä¸­ï¼Œæ»¡è¶³Commonjsè§„èŒƒ
    module.exports = fac() // ä»¥commonjsçš„è§„èŒƒå»æš´éœ²æ¥å£
  } else {
    root.some = fac() // æš´éœ²ç»™æµè§ˆå™¨çš„å…¨å±€ç¯å¢ƒï¼Œrootå…¶å®å°±æ˜¯window
  }
})
```

### ESMï¼ˆES6 Moduleï¼‰

ES6 åœ¨è¯­è¨€æ ‡å‡†çš„å±‚é¢ä¸Šï¼Œå®ç°äº†æ¨¡å—åŠŸèƒ½ï¼Œè€Œä¸”å®ç°å¾—ç›¸å½“ç®€å•ï¼Œæ—¨åœ¨æˆä¸ºæµè§ˆå™¨å’ŒæœåŠ¡å™¨é€šç”¨çš„æ¨¡å—è§£å†³æ–¹æ¡ˆã€‚```webpack3```åŸç”Ÿæ”¯æŒ

- **ä¸€ä¸ªæ–‡ä»¶ä¸ºä¸€ä¸ªæ¨¡å—**
- **ä½¿ç”¨```export```æš´éœ²æ¨¡å—å†…çš„å¸¸é‡ã€å‡½æ•°ã€æ–‡ä»¶ã€æ¨¡å—ç­‰ï¼Œæš´éœ²çš„æ˜¯å¯¹å€¼çš„å¼•ç”¨**
  - ```ES6 Module```æš´éœ²å‡ºå»çš„æ˜¯ä¸€ç§é™æ€å®šä¹‰ï¼ˆå¼•ç”¨ï¼‰
- ```export```å‘½ä»¤è§„å®šçš„æ˜¯å¯¹å¤–çš„æ¥å£ï¼Œå¿…é¡»ä¸æ¨¡å—å†…éƒ¨çš„å˜é‡å»ºç«‹ä¸€ä¸€å¯¹åº”å…³ç³»ã€‚

- **ä½¿ç”¨importå¼•å…¥æ¨¡å—**
  - ```ES6 Module```æ¨¡å—å¯¹å¯¼å‡ºæ¨¡å—ï¼Œå˜é‡ï¼Œå¯¹è±¡æ˜¯åŠ¨æ€å¼•ç”¨ï¼Œé‡åˆ°æ¨¡å—åŠ è½½å‘½ä»¤```import```æ—¶ä¸ä¼šå»æ‰§è¡Œæ¨¡å—ï¼Œ**åªæ˜¯ç”Ÿæˆä¸€ä¸ªæŒ‡å‘è¢«åŠ è½½æ¨¡å—çš„å¼•ç”¨ï¼Œä¸å­˜åœ¨ç¼“å­˜å€¼çš„é—®é¢˜**ã€‚
  - å¼•ç”¨å¸¦æ¥çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œ**ä¸ä¼šç¼“å­˜è¿è¡Œç»“æœï¼Œè€Œæ˜¯åŠ¨æ€åœ°å»è¢«åŠ è½½çš„æ¨¡å—å–å€¼**ï¼Œä¹Ÿå°±æ˜¯æ¨¡å—æš´éœ²çš„å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šè¿‡```import```å¼•å…¥çš„å€¼æœ¬èº«ä¹Ÿä¼šç›¸åº”çš„å˜åŒ–ï¼ˆåœ¨åé¢å¾ªç¯åŠ è½½ç« èŠ‚ä¼šè¯¦ç»†é˜è¿°ï¼‰
- **æ¨¡å—æ˜¯ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£ï¼ˆç¼–è¯‘æ—¶åŠ è½½ï¼‰**
  - ```ES6 Module```æš´éœ²å‡ºå»çš„æ˜¯ä¸€ç§é™æ€å®šä¹‰ï¼ˆå¼•ç”¨ï¼‰ï¼Œåœ¨ä»£ç é™æ€è§£æé˜¶æ®µå°±ä¼šç”Ÿæˆ

> `import/export` æœ€ç»ˆéƒ½æ˜¯ç¼–è¯‘ä¸º `require/exports` æ¥æ‰§è¡Œçš„

```js
// foo.js æš´éœ²æ¥å£
export const NUM = 12
function fn() {
  console.log('fn')
}
export { fn }
export default class myClass {...} // é»˜è®¤æš´éœ²


// app.js å¼•å…¥æ¨¡å—
import myClass, { fn, NUM } from 'other_module'
```

> ç›®å‰```webpack```æ”¯æŒ```AMDï¼ˆrequireJSï¼‰```ã€```ES6 Module```ï¼ˆå®˜æ–¹æ¨èï¼‰ã€```CommonJS```



>`require`: node å’Œ es6 éƒ½æ”¯æŒçš„å¼•å…¥
>`export / import` : åªæœ‰es6 æ”¯æŒçš„å¯¼å‡ºå¼•å…¥
>`module.exports / exports`: åªæœ‰ node æ”¯æŒçš„å¯¼å‡º

## äºŒã€ç†è§£CommonJSä¸­çš„exportsã€module.exports

```CommonJS```è§„èŒƒä¸­è®¤ä¸ºä¸€ä¸ªæ–‡ä»¶å³ä¸€ä¸ªæ¨¡å—

```CommonJS```æ˜¯è¿è¡Œåœ¨NodejsæœåŠ¡ç«¯çš„ï¼ŒNodeä¸ºæ¯ä¸ªæ¨¡å—éƒ½åˆ›å»ºä¸€ä¸ª```module```å¯¹è±¡ä»¥ä»£è¡¨å½“å‰æ¨¡å—ï¼Œåˆå§‹å€¼ä¸º{}ï¼Œè¯¥å¯¹è±¡çš„```exports```å±æ€§ï¼ˆå³```module.exports```ï¼‰æ˜¯å¯¹å¤–çš„æ¥å£ï¼Œå½“é€šè¿‡**```require```åŠ è½½æŸä¸ªæ–‡ä»¶æ—¶ï¼Œå…¶å®å°±æ˜¯åŠ è½½è¯¥æ–‡ä»¶çš„```module.exports```**ã€‚ä¸‹é¢ä»£ç é€šè¿‡```module.exports```è¾“å‡ºå˜é‡elå’Œå‡½æ•°fn1ã€‚

```js
// foo1.js
const el = 5
const fn1 = function (val) {
  return `val: ${val}`
}
module.exports.el = el
module.exports.fn1 = fn1
```

```js
// index.js
var foo1 = require('./foo1') // åŠ è½½æ¨¡å—

console.log(foo1) // { a: 5, fn1: [Function: fn1] }
console.log(foo1.el) // 5
console.log(foo1.fn1(4)) // val: 4
```

å‰é¢è¯´äº†ï¼Œ```require```åŠ è½½æŸä¸ªæ–‡ä»¶æ—¶ï¼Œå…¶å®å°±æ˜¯åŠ è½½è¯¥æ–‡ä»¶çš„```module.exports```ï¼Œé‚£```exports```å¯¹è±¡æ˜¯ä»€ä¹ˆï¼Ÿ

ä¸ºäº†æ–¹ä¾¿ï¼Œ```Node```ä¸ºæ¯ä¸ªæ¨¡å—æä¾›ä¸€ä¸ª```exports```å¯¹è±¡ï¼Œå¹¶è®©```exports```å¯¹è±¡æŒ‡å‘```module.exports```ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œ```exports```å’Œ```module.exports```éƒ½æŒ‡å‘åŒä¸€å—å†…å­˜åŒºåŸŸï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨```exports```å¯¹è±¡ä¸Šæ·»åŠ å˜é‡ã€å‡½æ•°ã€ç±»ç­‰ï¼Œä»¥è¡¨ç¤ºå¯¹å¤–è¾“å‡ºçš„æ¥å£ï¼Œå¦‚åŒæ·»åŠ åœ¨```module.exports```ä¸€æ ·ã€‚å…¶ä½œç”¨å°±åƒğŸ‘‡è¿™è¡Œä»£ç ä¸€æ ·,

```js
var exports = module.exports; 
```

æ¥çœ‹ä¸€ä¸‹é€šè¿‡exportsæš´éœ²æ¥å£çš„ä»£ç ï¼š

```js
// foo1.js
const el = 5
const fn1 = function (val) {
  return `val: ${val}`
}
// ä¸module.exportsä¸Šæ–¹å†™æ³•ç›¸åŒæ•ˆæœ
exports.el = el
exports.fn1 = fn1
```

> ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸èƒ½ç›´æ¥å°†```exports```å˜é‡æŒ‡å‘ä¸€ä¸ªå€¼(ç›´æ¥è¢«è¦†ç›–å–å€¼ ä¾‹å¦‚ï¼šexport = xxx)ï¼Œå› ä¸ºè¿™æ ·ç­‰äºåˆ‡æ–­äº†```exports```ä¸```module.exports```çš„è”ç³»ï¼›ä¹Ÿä¸èƒ½ä¿®æ”¹```module.exports```å€¼ï¼Œè¿™æ ·ä¹Ÿä¼šè®©```exports```åˆ‡æ–­è”ç³»

æä¸ªğŸŒ°æ„Ÿå—ä¸‹è¿™å¥è¯çš„æ„æ€

```js
// index.js
var foo1 = require('./foo1');
console.log(foo1)

// fool1.js 
// eg1ï¼š åœ¨ç¬¬ä¸€æ¬¡èµ‹å€¼ä¹‹åï¼Œå¦‚æœå•ç‹¬ä¿®æ”¹module.exportsæŒ‡å‘ï¼Œexportè¿˜æ˜¯åœç•™åœ¨ä¸Šä¸€æ¬¡èµ‹å€¼çš„å€¼,å¹¶ä¸”æ­¤æ—¶é€šè¿‡exportsæš´éœ²ä»»ä½•å˜é‡ã€å‡½æ•°ç­‰æ˜¯æ²¡æœ‰ç”¨çš„ï¼Œå› ä¸ºexportå·²ç»ä¸æŒ‡å‘module.exportsäº†
var exports = module.exports = {a: 1}
module.exports = {a: 2} // æ­¤æ—¶exportså€¼ä¸º{a: 1}
const el = 5
exports.el = el // index.jsè¾“å‡ºçš„å€¼ï¼š{a: 2}

// fool1.js  
// eg2ï¼šä¿®æ”¹exportså€¼ï¼ŒåŒæ ·å¯¼è‡´exportæ–­å¼€ä¸module.exportsçš„è”ç³»
var exports = module.exports
const el = 5
exports = {} // exportæŒ‡å‘æ–°çš„å¯¹è±¡
exports.el = el // index.jsè¾“å‡ºçš„å€¼ï¼š{}ï¼Œå› ä¸ºmodule.exportsé»˜è®¤æ˜¯{}
```

ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œ```require```æ°¸è¿œåªä¼šå¯¼å‡º```module.exports```çš„å†…å®¹ï¼Œ```exports```å°±å¥½ä¼¼ä¸€ä¸ªä»£é©¾ï¼Œå½“æ–­å¼€ä¸```module.exports```çš„è”ç³»ï¼Œä»–å°±æ²¡ç”¨äº†ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯æ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨```module.exports```è¿™ä¸ªå¯¹è±¡



æ€»ç»“ä¸€ä¸‹``` exports ```å’Œ ```module.exports ```çš„åŒºåˆ«äº†ï¼š

- **```module.exports``` åˆå§‹å€¼ä¸ºä¸€ä¸ªç©ºå¯¹è±¡ {}**
- **```exports ```æ˜¯æŒ‡å‘çš„ ```module.exports ```çš„å¼•ç”¨**
- **```require()```è¿”å›çš„å€¼æ˜¯è¢«åŠ è½½æ–‡ä»¶çš„```module.exports```**



å¦‚æœæœ‰äººæœ‰ç–‘é—®ï¼Œæ—¢ç„¶æ˜¯å¼•ç”¨å…³ç³»ï¼Œä¸ºå•¥ä¿®æ”¹```exports```ä¸ä¼šåŒæ—¶ä¿®æ”¹```module.exports```çš„å€¼ï¼Ÿå¯ä»¥çœ‹çœ‹ğŸ‘‡ä»£ç ç†è§£ä¸‹å¼•ç”¨çš„æ„æ€

```js
var a = {name: 'one'}
var b = a
console.log(a) // {name: 'one'}
console.log(b) // {name: 'one'}

b.name = 'two'
console.log(a) // {name: 'two'}
console.log(b) // {name: 'two'}

var b = {name: 'three'}
console.log(a) // {name: 'two'}
console.log(b) // {name: 'three'}
```

a æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œb æ˜¯å¯¹ a çš„å¼•ç”¨ï¼Œå³ a å’Œ b æŒ‡å‘åŒä¸€å—å†…å­˜ï¼Œæ‰€ä»¥å‰ä¸¤ä¸ªè¾“å‡ºä¸€æ ·ã€‚å½“å¯¹ b ä½œä¿®æ”¹æ—¶ï¼Œå³ a å’Œ b æŒ‡å‘åŒä¸€å—å†…å­˜åœ°å€çš„å†…å®¹å‘ç”Ÿäº†æ”¹å˜ï¼Œæ‰€ä»¥ a ä¹Ÿä¼šä½“ç°å‡ºæ¥ï¼Œæ‰€ä»¥ç¬¬ä¸‰å››ä¸ªè¾“å‡ºä¸€æ ·ã€‚**å½“ b è¢«è¦†ç›–æ—¶ï¼Œb æŒ‡å‘äº†ä¸€å—æ–°çš„å†…å­˜ï¼Œa è¿˜æ˜¯æŒ‡å‘åŸæ¥çš„å†…å­˜ï¼Œæ‰€ä»¥æœ€åä¸¤ä¸ªè¾“å‡ºä¸ä¸€æ ·**ã€‚

## ä¸‰ã€ç†è§£ES6 Moduleçš„exportã€export default

```ES6 module```æ˜¯é€šè¿‡```export```å’Œ```export default```æ¥æš´éœ²æ¥å£ï¼Œé‚£å®ƒä»¬çš„è”ç³»å’ŒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

å…ˆè¯´æ˜```export```å’Œ```export default ```çš„åŒºåˆ«ï¼š

- **åœ¨ä¸€ä¸ªæ–‡ä»¶æˆ–æ¨¡å—ä¸­ï¼Œ```export```å¯ä»¥æœ‰å¤šä¸ªï¼Œ```export default```ä»…æœ‰ä¸€ä¸ª**

- **é€šè¿‡```export```æ–¹å¼å¯¼å‡ºï¼Œåœ¨å¯¼å…¥æ—¶è¦åŠ { }ï¼Œ```export default```åˆ™ä¸éœ€è¦**

- **```export```å¯ç›´æ¥å¯¼å‡ºå˜é‡è¡¨è¾¾å¼ï¼Œ```export default```ä¸å¯**

```js
// foo.js
// exportå¯¼å‡º
export const NUM1 = 1 // ç›´æ¥å¯¼å‡º
function fn () {
  console.log('res')
}
const NUM2 = 2
export { fn, NUM2 } // é—´æ¥å¯¼å‡º

// export defaultå¯¼å‡º
export default function fn1 () { // ç›´æ¥å¯¼å‡º
  console.log('res1')
}
// const NUM2 = 2
// export default NUM2 // é—´æ¥å¯¼å‡º
// export defult const NUM2 = 2 // export defaultä¸å¯å¯¼å‡ºå˜é‡è¡¨è¾¾å¼
```

```js
// index.js
import { NUM1, fn, NUM2 } from './foo' // å¯¼å‡ºäº†export
import fn1 from './foo'  // å¯¼å‡ºäº†export default
// import fn1, { NUM1, fn, NUM2 } from './foo' // ç­‰ä»·äºä¸Šé¢ä¸¤è¡Œ

import * as all from './foo' // å°†exportå’Œexport defaultæš´éœ²å‡ºçš„æ¥å£éƒ½ç”¨å¯¹è±¡allè¡¨ç¤º

fn1() // res1
fn() // res
console.log(NUM1) // 1
console.log(NUM2) // 2

console.log(all.NUM) // 1
console.log(all.default) // res1 export defaultæš´éœ²å‡ºæ¥çš„åœ¨allçš„defaultå±æ€§é‡Œ
```

å¦å¤–æä¸€ä¸‹ï¼Œæš´éœ²çš„æ–¹å¼è¿˜æœ‰ä¸€äº›æ‹“å±•çš„å†™æ³•

```js
// ç¬¬äºŒç§æ–¹å¼:å…ˆå®šä¹‰ï¼Œåæš´éœ²
const NUM = 12
function fn() {...}

export { NUM, fn } // æš´éœ²ä¸Šé¢å®šä¹‰çš„NUMå˜é‡å’Œfnå‡½æ•°
export { NUM as NUM_NEW, fn as fn1 } // ä»¥NUM_NEWä»£æ›¿NUMï¼Œè¢«æš´éœ²å‡ºå»ï¼›fnåŒç†ï¼Œimportä¹Ÿè¦ç”¨NUM_NEWå’Œfn1æ¥å¼•å…¥

// å¯ä»¥å°†å…¶ä»–æ¨¡å—çš„å†…å®¹å¼•å…¥è¿›æ¥ï¼Œç„¶åå†æš´éœ²å‡ºå»ï¼Œä½œä¸€ä¸ªä¸­è½¬ç«™
export {foo, bar} from 'other_module' // å¼•å…¥fooå’Œbaræ¥å£ï¼Œå¹¶å°†å…¶æš´éœ²å‡ºå»
export * from 'src/other_module' // è¡¨ç¤ºå…ˆå¼•å…¥other_moduleæ¨¡å—çš„æ‰€æœ‰æ¥å£ï¼Œç„¶åå…¨éƒ¨æš´éœ²å‡ºå»
export {foo as foo1, bar} from 'other_module' // ä¹Ÿå¯ä»¥è¿›è¡Œé‡å‘½åï¼Œå°†fooä»¥foo1çš„åå­—æš´éœ²å‡ºå»
```

## å››ã€CommonJSå’ŒES6 Moduleåº”å¯¹â€å¾ªç¯åŠ è½½â€œ

â€œå¾ªç¯åŠ è½½â€æŒ‡çš„æ˜¯ï¼Œ`a`è„šæœ¬çš„æ‰§è¡Œä¾èµ–`b`è„šæœ¬ï¼Œè€Œ`b`è„šæœ¬çš„æ‰§è¡Œåˆä¾èµ–`a`è„šæœ¬

```js
// a.js
var b = require('b');

// b.js
var a = require('a');
```

å¾ªç¯åŠ è½½æœ€å®¹æ˜“å‘ç”Ÿçš„æƒ…å†µå°±æ˜¯é€’å½’åŠ è½½ï¼Œå¯¼è‡´æ— é™å¾ªç¯ï¼Œä½†æ˜¯å¤æ‚é¡¹ç›®ä¸­æ¨¡å—ä¼—å¤šï¼Œæ¨¡å—äº’ç›¸ä¾èµ–çš„æƒ…å†µä¹Ÿæ—¶å¸¸å‘ç”Ÿï¼Œå› æ­¤ï¼Œä¸»æµçš„ä¸¤ä¸ªæ¨¡å—è§„èŒƒ```CommonJS```å’Œ```ES6 Module```ä¹Ÿç»™å‡ºäº†å„è‡ªçš„è§£å†³æ–¹æ¡ˆ

### CommonJSçš„å¾ªç¯åŠ è½½

å‰é¢è®¨è®ºè¿‡```CommonJS```çš„åŠ è½½åŸç†ï¼Œ```require```ç¬¬ä¸€æ¬¡åŠ è½½æ¨¡å—ä¼šç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œæ­¤åé‡å¤åŠ è½½è¯¥æ¨¡å—éƒ½æ˜¯ä»å¯¹è±¡ä¸­çš„```exports```å±æ€§ä¸­å–å€¼ã€‚é’ˆå¯¹å¾ªç¯åŠ è½½

> ğŸ‘‰```CommonJS```çš„æ–¹æ¡ˆæ˜¯ï¼š**ä¸€æ—¦å‡ºç°æŸä¸ªæ¨¡å—è¢«â€œå¾ªç¯åŠ è½½â€ï¼Œå°±åªè¾“å‡ºå·²ç»æ‰§è¡Œçš„éƒ¨åˆ†ï¼Œæ²¡æœ‰æ‰§è¡Œçš„éƒ¨åˆ†ä¸ä¼šè¾“å‡º**ã€‚

ç»“åˆğŸŒ°è¿›è¡Œç†è§£ï¼Œä¸‹é¢ğŸŒ°æ¥è‡ªäº[Nodeå®˜æ–¹æ–‡æ¡£](https://nodejs.org/api/modules.html#modules_cycles)

```js
//main.js
var a = require('./a.js');
var b = require('./b.js');

console.log('åœ¨main.jsä¸­ï¼Œa.done = %j, b.done = %j', a.done, b.done);
```

```js
//a.js
exports.done = false;

var b = require('./b.js');
console.log('åœ¨a.jsä¸­ï¼Œb.done = %j', b.done);

exports.done = true;
console.log('a.jsæ‰§è¡Œå®Œæ¯•ï¼')
```

```js
//b.js
exports.done = false;

var a = require('./a.js');
console.log('åœ¨b.jsä¸­ï¼Œa.done = %j', a.done);

exports.done = true;
console.log('b.jsæ‰§è¡Œå®Œæ¯•ï¼')
```

```js
node main.js // è¿è¡Œmain.js

è¾“å‡ºç»“æœï¼š
åœ¨b.jsä¸­ï¼Œa.done = false
b.jsæ‰§è¡Œå®Œæ¯•ï¼
åœ¨a.jsä¸­ï¼Œb.done = true
a.jsæ‰§è¡Œå®Œæ¯•ï¼
åœ¨main.jsä¸­ï¼Œa.done = true, b.done = true
```

- æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š
  - é¦–å…ˆåŠ è½½aæ¨¡å—ï¼Œaæ¨¡å—æš´éœ²done=falseï¼Œç„¶ååœ¨aæ¨¡å—ä¸­åŠ è½½bæ¨¡å—ï¼Œbæ¨¡å—æš´éœ²done=falseï¼Œç„¶ååŠ è½½aæ¨¡å—ï¼Œæ­¤æ—¶å‘ç”Ÿå¾ªç¯åŠ è½½
  - æ­¤æ—¶ï¼Œç³»ç»Ÿä¸ä¼šå»ç»§ç»­é‡æ–°åŠ è½½aæ¨¡å—ï¼Œè€Œæ˜¯ä»ä¹‹å‰åŠ è½½aæ¨¡å—æ—¶åˆ›å»ºçš„å¯¹è±¡ä¸­å–å€¼ï¼Œè€Œå…¶ä¸­çš„å€¼ä¹Ÿä»…ä»…æ˜¯å·²ç»æ‰§è¡Œå®Œçš„éƒ¨åˆ†ï¼Œç³»ç»Ÿä»å¯¹è±¡çš„```exports```å±æ€§ä¸­å–å€¼ï¼Œdone=falseï¼Œç„¶åç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œè¾“å‡º```åœ¨b.jsä¸­ï¼Œa.done = false```,ç„¶åè¾“å‡º```b.jsæ‰§è¡Œå®Œæ¯•ï¼```
  - bæ¨¡å—æ‰§è¡Œç»“æŸåï¼Œaæ¨¡å—å°±å¯ä»¥ç»§ç»­æ‰§è¡Œäº†ï¼Œæ­¤æ—¶bæ¨¡å—çš„done=trueï¼Œå› æ­¤è¾“å‡º```åœ¨a.jsä¸­ï¼Œb.done = true```ï¼Œç„¶åè¾“å‡º```a.jsæ‰§è¡Œå®Œæ¯•ï¼```
  - æ­¤æ—¶aï¼Œbéƒ½æ‰§è¡Œç»“æŸï¼Œä¸”éƒ½åœ¨å†…å­˜åˆ›å»ºå¯¹åº”çš„å¯¹è±¡ï¼Œåœ¨main.jsä¸­åŠ è½½aã€bæ¨¡å—ï¼Œåˆ™ç›´æ¥ä»å¯¹è±¡ä¸­è·å–```exports```å±æ€§

### ES6 Moduleçš„å¾ªç¯åŠ è½½

å‰é¢ä»‹ç»äº†```ES6 Module```ä¸¤ä¸ªç‰¹ç‚¹ï¼š

> 1ã€ä½¿ç”¨```export```æš´éœ²æ¥å£ï¼Œæš´éœ²çš„æ˜¯å¯¹å€¼çš„å¼•ç”¨
>
> 2ã€ä½¿ç”¨```import```åŠ¨æ€å¼•å…¥æ¨¡å—ï¼Œé‡åˆ°importæ—¶ä¸ä¼šå»æ‰§è¡Œæ¨¡å—ï¼Œåªæ˜¯ç”Ÿæˆä¸€ä¸ªæŒ‡å‘è¢«åŠ è½½æ¨¡å—çš„å¼•ç”¨ï¼Œç­‰åˆ°çœŸçš„éœ€è¦ç”¨åˆ°æ¨¡å—æ—¶ï¼Œå†åˆ°æ¨¡å—é‡Œé¢å»å–å€¼ã€‚

ä¸¾ä¸ªğŸŒ°ï¼Œä¾‹å­æ¥æºäº[é˜®ä¸€å³°](http://www.ruanyifeng.com/blog/2015/11/circular-dependency.html)

```js
// a.js
export var foo = 'bar';
setTimeout(() => foo = 'baz', 500);

// b.js
import {foo} from './m1.js';
console.log(foo);
setTimeout(() => console.log(foo), 500);

// æ‰§è¡Œb.jsï¼Œè¾“å‡ºä¸ºï¼š
bar
baz
```

ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œa.jsçš„å˜é‡fooï¼Œåœ¨åˆšåŠ è½½æ—¶ç­‰äºbarï¼Œè¿‡äº†500æ¯«ç§’ï¼Œåˆå˜ä¸ºç­‰äºbazï¼Œb.jsä¸€å¼€å§‹è·å–åˆ°fooçš„å€¼æ—¶barï¼Œ500æ¯«ç§’åè·å–çš„å€¼æ—¶bazï¼Œè¿™å°±è¯´æ˜```ES6 Module``` ä¸ä¼šå»ç¼“å­˜è¿è¡Œç»“æœï¼Œè€Œæ˜¯åŠ¨æ€åœ°å»å–è¢«åŠ è½½æ¨¡å—æš´éœ²çš„å€¼ï¼Œå› ä¸º```import```ç”Ÿæˆçš„å¼•ç”¨ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªåœ°å€å¼•ç”¨ï¼ŒæŒ‡å‘é‚£å—æ•°æ®çš„å†…å­˜

> ğŸ‘‰```ES6 Module```ä¸ä¼šå…³å¿ƒimportæ˜¯å¦å‘ç”Ÿâ€å¾ªç¯åŠ è½½â€œï¼Œå› ä¸ºå®ƒä»…ä»…ç”Ÿæˆä¸€ä¸ªå¼•ç”¨ï¼Œéœ€è¦å¼€å‘è€…è‡ªå·±ä¿è¯ï¼Œåœ¨æ–‡ä»¶ä¸­çœŸæ­£ä½¿ç”¨è¢«åŠ è½½æ¨¡å—æ—¶ï¼Œå¼•ç”¨æ˜¯å¯ä»¥å–åˆ°å€¼

ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ–‡ä»¶ä¸­ä½¿ç”¨```import```åŠ è½½Aæ¨¡å—æ—¶ï¼Œä»…ä»…æ˜¯ç”Ÿæˆä¸€ä¸ªå¼•ç”¨ï¼ˆç±»ä¼¼æŒ‡é’ˆï¼‰ï¼Œè¯¥å¼•ç”¨æŒ‡å‘çš„æ˜¯Aæ¨¡å—æš´éœ²æ¥å£çš„åœ°å€ï¼Œå› æ­¤ï¼Œå¼€å‘è€…å¿…é¡»ä¿è¯åœ¨çœŸæ­£ä½¿ç”¨Aæ¨¡å—æ—¶ï¼Œæ˜¯å¯ä»¥å–åˆ°Aæ¨¡å—çš„å€¼ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™

```js
// a.js
import {resB} from './b'
console.log('a')
export const resA = 2

// b.js
import {resA} from './a'
console.log('b')
export const resB = 3
console.log(resA)

// è¾“å‡ºç»“æœ
b
undefined
a
```

ä¸Šè¿°ä»£ç ï¼Œa.jsåŠ è½½b.jsï¼Œb.jsåˆåŠ è½½a.jsï¼Œæ„æˆäº†å¾ªç¯åŠ è½½ã€‚æŒ‰ç…§```CommonJS```è§„èŒƒï¼Œä¸Šé¢çš„ä»£ç æ˜¯æ²¡æ³•æ‰§è¡Œçš„ã€‚`a`å…ˆåŠ è½½`b`ï¼Œç„¶å`b`åˆåŠ è½½`a`ï¼Œè¿™æ—¶`a`è¿˜æ²¡æœ‰ä»»ä½•æ‰§è¡Œç»“æœï¼Œæ‰€ä»¥è¾“å‡ºç»“æœä¸º`null`ï¼Œå³å¯¹äº`b.js`æ¥è¯´ï¼Œå˜é‡resAçš„å€¼ç­‰äº`null`ï¼Œåé¢çš„`foo()`å°±ä¼šæŠ¥é”™ã€‚

è®©æˆ‘ä»¬ä¸€è¡Œè¡Œæ¥çœ‹ï¼ŒES6 å¾ªç¯åŠ è½½æ˜¯æ€ä¹ˆå¤„ç†çš„ã€‚é¦–å…ˆï¼Œæ‰§è¡Œa.jsä»¥åï¼Œå¼•æ“å‘ç°å®ƒåŠ è½½äº†b.jsï¼Œå› æ­¤ä¼šä¼˜å…ˆæ‰§è¡Œb.jsï¼Œç„¶åå†æ‰§è¡Œa.jsã€‚æ¥ç€ï¼Œæ‰§è¡Œb.jsçš„æ—¶å€™ï¼Œå·²çŸ¥å®ƒä»a.jsè¾“å…¥äº†resAæ¥å£ï¼Œè¿™æ—¶ä¸ä¼šå»æ‰§è¡Œa.jsï¼Œè€Œæ˜¯è®¤ä¸ºè¿™ä¸ªæ¥å£å·²ç»å­˜åœ¨äº†ï¼Œç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ‰§è¡Œåˆ°console.log(resA)æ—¶ï¼Œå‘ç°è¿™ä¸ªæ¥å£æ²¡æœ‰å®šä¹‰ï¼Œç„¶åè¾“å‡ºundefinedã€‚æ¥ç€ç»§ç»­æ‰§è¡Œa.jsï¼Œè¾“å‡ºa

> è¡¥å……çŸ¥è¯†ç‚¹ï¼šåœ¨ä»£ç è¿è¡Œå‰ï¼Œ**å‡½æ•°å£°æ˜å’Œå˜é‡å®šä¹‰**é€šå¸¸ä¼šè¢«è§£é‡Šå™¨ç§»åŠ¨åˆ°å…¶**æ‰€åœ¨ä½œç”¨åŸŸ**çš„æœ€é¡¶éƒ¨ã€‚å¦‚æœæŠŠå‡½æ•°å†™æˆå‡½æ•°è¡¨è¾¾å¼ï¼Œå°±ä¸å…·æœ‰æå‡ä½œç”¨äº†

é‚£å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿå¯ä»¥åˆ©ç”¨å‡½æ•°æå‡æ¥è§£å†³ï¼Œåœ¨a.jsä¸­é€šè¿‡å‡½æ•°åŒ…è£¹NUMå¸¸é‡ï¼Œç„¶åå°†è¯¥å€¼è¿›è¡Œè¿”å›ï¼Œç”±äºå‡½æ•°ä¼šè¢«æå‡ï¼Œæ‰€ä»¥å½“b.jsæ‰§è¡ŒresA()çš„æ—¶å€™ï¼Œa.jsçš„resAå·²ç»è¢«å£°æ˜äº†ï¼Œæ­¤æ—¶æ‰§è¡Œconsole.log(resA())å°±èƒ½å¾—åˆ°æ­£å¸¸çš„ç»“æœ

```js
// a.js
import {resB} from './b'
console.log('a')
function resA() {
  const NUM = 2
  return NUM
}
export { resA }

// b.js
import {resA} from './a'
console.log('b')
export const Foo2 = 3
console.log(resA())

// è¾“å‡ºç»“æœ
b
2
a
```

### æ‹“å±•åˆ†æ

æ˜¯å¦ä¼šæœ‰ç–‘é—®ï¼šâ€œES6é‡åˆ°importæ˜æ˜ä¼šç”Ÿæˆä¸€ä¸ªå¼•ç”¨ï¼Œä¸ºä»€ä¹ˆä¼šå»æ‰§è¡Œå¼•ç”¨çš„æ¨¡å—ä»£ç ï¼Ÿâ€

>Moduleæ€»æ˜¯å…ˆæ‰§è¡Œä¾èµ–ï¼Œä½†æ˜¯é‡åˆ°å¾ªç¯åŠ è½½çš„æ—¶å€™ï¼Œå°±ä¸ä¼šç»§ç»­æ‰§è¡Œä¸‹å»ã€‚Module æ‰§è¡Œåˆ† **```Parse, Instantiate, Evaluate```**å‡ æ­¥ï¼š
>
>â€‹       **```Parse```** :è§£ææ•´ä¸ªä»£ç ï¼Œæ”¶é›†ä¾èµ–
>
>â€‹       **```Instantiate```** :é€’å½’åœ°åŠ è½½ä¾èµ–ï¼Œåˆ›å»ºæ‰€æœ‰å…¨å±€å˜é‡ã€å¯¼å…¥ç¬¦å·åœ°ç»‘å®š
>
>â€‹       **```Evaluate```**: å¼€å§‹é€’å½’çš„æ‰§è¡Œä»£ç ï¼ˆè¢«å¯¼å…¥çš„å…ˆæ‰§è¡Œï¼‰ï¼Œé€’å½’åœ¨æ²¡æœ‰ä¾èµ–æˆ–é‡åˆ°å¾ªç¯çš„æ—¶å€™åœæ­¢



## äº”ã€AMDå¯¹æ¯”CMDã€CommonJSå¯¹æ¯”ES6 Module

### AMDä¸CMDçš„å·®å¼‚

- ```AMD```æ¨å´‡ä¾èµ–å‰ç½®ï¼Œ```CMD```æ¨å´‡ä¾èµ–å°±è¿‘
  - ```RequireJS```ï¼ˆ```AMD```ï¼‰ä»2.0å¼€å§‹ï¼Œ ```AMD```ä¹Ÿæ”¯æŒ```CMD```å†™æ³•ï¼Œä½†ä¾èµ–å‰ç½®æ˜¯å®˜æ–¹æ–‡æ¡£çš„é»˜è®¤æ¨¡å—å®šä¹‰å†™æ³•
- ```AMD```çš„APIé»˜è®¤æ˜¯ä¸€ä¸ªå½“å¤šä¸ªç”¨ï¼Œ```CMD```ä¸¥æ ¼çš„åŒºåˆ†æ¨å´‡èŒè´£å•ä¸€
  - ä¾‹å¦‚ï¼š```AMD```é‡Œ```require```åˆ†å…¨å±€çš„å’Œå±€éƒ¨çš„ã€‚```CMD```é‡Œé¢æ²¡æœ‰å…¨å±€çš„``` require```ï¼Œæä¾› ```seajs.use()```æ¥å®ç°æ¨¡å—ç³»ç»Ÿçš„åŠ è½½å¯åŠ¨ã€‚```CMD```é‡Œæ¯ä¸ªAPIéƒ½ç®€å•çº¯ç²¹

### CommonJSä¸ES6 Moduleçš„å·®å¼‚

- ```CommonJS```æš´éœ²å‡ºçš„æ˜¯ä¸€ä¸ªå€¼çš„æ‹·è´ï¼Œä¸€æ—¦æš´éœ²æ¥å£ï¼Œè¿™ä¸ªæ¥å£åœ¨æ¨¡å—å†…éƒ¨çš„å˜åŒ–æ˜¯ç›‘å¬ä¸åˆ°çš„ï¼›```ES6 Module```æš´éœ²çš„æ˜¯å†…å®¹çš„å¼•ç”¨ï¼Œæ¨¡å—å†…éƒ¨è¢«æš´éœ²çš„æ¥å£æ”¹å˜ä¼šå½±å“å¼•ç”¨çš„æ”¹å˜
- è‹¥é‡åˆ°é‡å¤åŠ è½½çš„æƒ…å†µï¼Œ```CommonJS```ä¼šç›´æ¥ä»ç¬¬ä¸€æ¬¡åŠ è½½æ—¶ç”Ÿæˆå¯¹è±¡çš„```exports```å±æ€§ä¸­å–å€¼ï¼›```ES6 Module```åˆ™ä¼šé€šè¿‡å¼•ç”¨æ‰¾åˆ°æ¨¡å—æš´éœ²æ¥å£çš„å†…å­˜ä½ç½®ï¼Œå¹¶ä»ä¸­å–å€¼
- è‹¥å‡ºç°å¾ªç¯åŠ è½½æƒ…å†µï¼Œ```CommonJS```åªè¾“å‡ºå·²ç»æ‰§è¡Œçš„éƒ¨åˆ†ï¼Œè¿˜æœªæ‰§è¡Œçš„éƒ¨åˆ†ä¸ä¼šè¾“å‡ºï¼›```ES6 Modul```eéœ€è¦å¼€å‘è€…è‡ªå·±ä¿è¯ï¼ŒçœŸæ­£å–å€¼çš„æ—¶å€™èƒ½å¤Ÿå–åˆ°å€¼
- ```CommonJS```æ˜¯åŠ è½½æ—¶æ‰§è¡Œï¼Œè‹¥å‡ºç°å¾ªç¯åŠ è½½æƒ…å†µï¼Œåˆ™ä»å·²æ‰§è¡Œçš„å†…å®¹ä¸­å–å€¼ï¼›```ES6 Module```æ˜¯åŠ¨æ€å¼•ç”¨ï¼ŒåŠ è½½æ¨¡å—æ—¶ä¸æ‰§è¡Œä»£ç ï¼Œåªæ˜¯ç”Ÿæˆä¸€ä¸ªæŒ‡å‘è¢«åŠ è½½æ¨¡å—çš„å¼•ç”¨
- ```CommonJS ```æ¨¡å—æ˜¯è¿è¡Œæ—¶åŠ è½½ï¼Œ```ES6 Module```æ¨¡å—æ˜¯ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£
- ```CommonJS```æ˜¯åŠ è½½æ•´ä¸ªæ¨¡å—ï¼Œ```ES6 Module```å¯ä»¥æŒ‰éœ€åŠ è½½éƒ¨åˆ†æ¥å£



> å¸Œæœ›çœ‹å®Œæœ¬ç¯‡æ–‡ç« èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œ

> æ–‡ä¸­å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡æ­£ï¼Œå¦‚æœè¿™ç¯‡æ–‡ç« å¸®åŠ©åˆ°äº†ä½ ï¼Œæ¬¢è¿ç‚¹èµå’Œå…³æ³¨ã€‚

## å‚è€ƒèµ„æ–™ ğŸ“–

[å‰ç«¯æ¨¡å—åŒ–å¼€å‘é‚£ç‚¹å†å²](https://github.com/seajs/seajs/issues/588)

[é˜®ä¸€å³°-Moduleçš„åŠ è½½å®ç°](http://es6.ruanyifeng.com/#docs/module-loader)

[å‰ç«¯æ¨¡å—åŒ–ä¹‹AMDä¸CMDåŸç†(é™„æºç )](https://juejin.im/post/5c3592b26fb9a049aa6f4456#heading-12)

[ä½ çœŸçš„æ‡‚æ¨¡å—åŒ–å—ï¼Ÿæ•™ä½ CommonJSå®ç°](https://juejin.im/post/5b67c342e51d45172832123d)



